<?xml version="1.0" encoding="UTF-8"?>
<Configuration>
  <Properties>
    <Property name="LOG_FILE_NAME">logging-prac</Property>
    <Property name="LOG_FILE_PATH">./logs</Property>
    <Property name="LOGSTASH_HOST">localhost</Property>
    <Property name="LOGSTASH_PORT">5044</Property>
    <Property
      name="COLOR_PATTERN">[%clr{%d{yyyy-MM-dd HH:mm:ss.SSS}}{faint}][%clr{%5p}][%clr{${sys:PID}}{magenta}] %clr{---}{faint} %clr{[%15.15t]}{faint} %clr{%logger{36}:%L}{cyan} %clr{:}{faint} %m%n
    </Property>
    <Property
      name="DEFAULT_PATTERN">[%d{yyyy-MM-dd HH:mm:ss.SSS}][%5p][${sys:PID}] --- [%15.15t] %logger{36}:%L : %m%n
    </Property>
  </Properties>

  <Appenders>
    <Console name="CONSOLE_APPENDER" target="SYSTEM_OUT">
      <PatternLayout pattern="${COLOR_PATTERN}"/>
    </Console>

    <RollingFile name="FILE_APPENDER" fileName="${LOG_FILE_PATH}/${LOG_FILE_NAME}.log"
                 filePattern="${LOG_FILE_PATH}/${LOG_FILE_NAME}_%d{yyyy-MM-dd-HH-mm}_%i.log">
      <PatternLayout charset="UTF-8" pattern="${DEFAULT_PATTERN}"/>
      <Policies>
        <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
      </Policies>
      <DefaultRolloverStrategy max="5">
        <Delete basePath="${LOG_FILE_PATH}" maxDepth="1">
          <IfFileName glob="logging-prac_*.log"/>
          <IfAccumulatedFileCount exceeds="5"/>
        </Delete>
      </DefaultRolloverStrategy>
    </RollingFile>

    <!-- Simple Logstash TCP Appender -->
    <Socket name="LOGSTASH_APPENDER"
            host="${LOGSTASH_HOST}"
            port="${LOGSTASH_PORT}"
            protocol="TCP">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%level] [%thread] %logger{36} - %msg%n"/>
    </Socket>

  </Appenders>

  <Loggers>
    <Root level="INFO" additivity="false">
      <AppenderRef ref="CONSOLE_APPENDER"/>
      <AppenderRef ref="FILE_APPENDER"/>
      <AppenderRef ref="LOGSTASH_APPENDER"/>
    </Root>
  </Loggers>
</Configuration>